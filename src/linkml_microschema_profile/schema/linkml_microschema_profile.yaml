---
id: https://w3id.org/linkml/linkml-microschema-profile
name: linkml-microschema-profile
title: LinkML Microschema Profile
version: "0.2.0"
description: |-
  A LinkML schema defining the Microschema Profile for composable data elements.
  Microschemas are designed for inline composition without identifiers.
license: MIT
see_also:
  - https://linkml.github.io/linkml-microschema-profile

prefixes:
  coms: https://w3id.org/linkml/linkml-microschema-profile/
  linkml: https://w3id.org/linkml/
  schema: http://schema.org/
  PATO: http://purl.obolibrary.org/obo/PATO_
  bdchm: https://w3id.org/bdchm/
  OBA: http://purl.obolibrary.org/obo/OBA_
  OMOP: https://athena.ohdsi.org/search-terms/terms/
  LOINC: https://loinc.org/
  UCUM: https://units-of-measurement.org/
  UBERON: http://purl.obolibrary.org/obo/UBERON_
  MONDO: http://purl.obolibrary.org/obo/MONDO_
  HP: http://purl.obolibrary.org/obo/HP_
  RxNorm: http://purl.bioontology.org/ontology/RXNORM/
  ISO11179: http://purl.org/iso11179/
  example: http://www.example.org/rdf#
default_prefix: coms
default_range: string

imports:
  - linkml:types

classes:

  #────────────────────────────────────────────────────────────────
  # METACLASSES: Define what makes a class a "Microschema"
  #────────────────────────────────────────────────────────────────

  MicroschemaDefinition:
    class_uri: coms:MicroschemaDefinition
    mixin: true
    description: >-
      A metaclass for classes that conform to the Microschema profile.
      Classes that instantiate this are designed for inline composition.
    comments:
      - Classes instantiating this SHOULD NOT have identifier slots
      - Classes instantiating this SHOULD be used with inlined=true
      - Classes instantiating this MAY compose other microschemas via attributes
    slots:
      - profile_version
      - semantic_mapping
      - domain_of_use

  ValueMicroschemaDefinition:
    class_uri: coms:ValueMicroschemaDefinition
    is_a: MicroschemaDefinition
    mixin: true
    description: >-
      A microschema representing a typed value with optional unit/system.
      Examples: Quantity, Timepoint, CodedValue, Range.

  #────────────────────────────────────────────────────────────────
  # VALUE MICROSCHEMAS: Leaf value types
  #────────────────────────────────────────────────────────────────

  Quantity:
    mixins:
      - ValueMicroschemaDefinition
    description: >-
      A value with a unit
    attributes:
      value:
        range: decimal
        description: The numeric value
      unit:
        range: uriorcurie
        description: A unit from UCUM

  #────────────────────────────────────────────────────────────────
  # CDE MICROSCHEMAS: Domain-specific composable data elements
  #────────────────────────────────────────────────────────────────

  MeasurementObservationCde:
    mixins:
      - MicroschemaDefinition
    description: >-
      A data structure with key and value attributes that represents a single observation
    class_uri: bdchm:MeasurementObservation
    slots:
      - subject_identifier
      - measurement_type
      - unit
      - method
      - instrument
      - reagent_kit
      - ulod
      - llod
      - calculated_from
      - body_location
      - body_position
      - context
      - collected_by
      - data_type
      - age_at_observation

  ConditionStatusCde:
    mixins:
      - MicroschemaDefinition
    description: >-
      Record suggesting the presence of a disease or medical condition stated as a diagnosis, sign, or symptom
    class_uri: bdchm:Condition
    slots:
      - subject_identifier
      - condition_type
      - method
      - diagnosis_method
      - instrument
      - age_at_condition_start
      - age_at_condition_end

  DrugStatusCde:
    mixins:
      - MicroschemaDefinition
    description: >-
      Record suggesting exposure to a medication
    class_uri: bdchm:DrugExposure
    slots:
      - subject_identifier
      - drug_type
      - method
      - collected_by
      - age_at_exposure_start
      - age_at_exposure_end

  ProcedureStatusCde:
    mixins:
      - MicroschemaDefinition
    description: >-
      Record of activity or process ordered by or carried out by a healthcare provider for a diagnostic or therapeutic reason
    class_uri: bdchm:Procedure
    slots:
      - subject_identifier
      - procedure_type
      - method
      - collected_by
      - age_at_procedure

  SdohObservationCde:
    mixins:
      - MicroschemaDefinition
    description: >-
      A data structure with key and value attributes that represents a single SDOH observation
    class_uri: bdchm:SdohObservation
    slots:
      - subject_identifier
      - sdoh_type
      - unit
      - method
      - context
      - collected_by
      - data_type
      - age_at_observation

  #────────────────────────────────────────────────────────────────
  # CONTAINER: For collecting CDE instances
  #────────────────────────────────────────────────────────────────

  CdeCollection:
    tree_root: true
    description: >-
      A holder for CDE objects
    attributes:
      entries:
        description: The collection of CDE objects
        any_of:
          - range: MeasurementObservationCde
          - range: ConditionStatusCde
          - range: DrugStatusCde
          - range: ProcedureStatusCde
          - range: SdohObservationCde
        multivalued: true
        inlined_as_list: true

#────────────────────────────────────────────────────────────────
# SLOTS
#────────────────────────────────────────────────────────────────

slots:
  # Microschema profile slots
  profile_version:
    range: string
    description: Version of microschema profile this conforms to

  semantic_mapping:
    range: uriorcurie
    multivalued: true
    description: >-
      URIs/CURIEs mapping this microschema to external standards
      (ISO-11179 DEC, NIH CDE, etc.)

  domain_of_use:
    range: string
    multivalued: true
    description: Domains where this microschema is applicable

  # Domain slots
  subject_identifier:
    range: string
    description: An identifier for the subject of the datum
  measurement_type:
    range: uriorcurie
    slot_uri: bdchm:observation_type
    description: A CURIE from OBA, OMOP, or LOINC
  unit:
    range: uriorcurie
    slot_uri: bdchm:unit
    description: A unit from UCUM
  method:
    range: MethodEnum
    slot_uri: bdchm:method_type
    description: The method used for the measurement
  instrument:
    range: InstrumentEnum
    description: The instrument used for the measurement
  reagent_kit:
    range: ReagentKitEnum
    description: The reagent kit used for the measurement
  ulod:
    range: Quantity
    description: Upper limit of detection
  llod:
    range: Quantity
    description: Lower limit of detection
  calculated_from:
    description: An expression pointing at other CDE classes
  body_location:
    range: uriorcurie
    slot_uri: bdchm:BodySite
    description: A CURIE from UBERON
  body_position:
    range: BodyPositionEnum
    description: The body position during measurement
  context:
    range: ContextEnum
    description: The context of the measurement
  collected_by:
    range: CollectedByEnum
    description: Who collected the measurement
  condition_type:
    range: uriorcurie
    slot_uri: bdchm:condition_concept
    description: A CURIE from MONDO or HPO
  diagnosis_method:
    range: DiagnosisMethodEnum
    description: The method used for diagnosis
  drug_type:
    range: uriorcurie
    slot_uri: bdchm:drug_concept
    description: A CURIE from RxNorm
  procedure_type:
    range: uriorcurie
    slot_uri: bdchm:procedure_concept
    description: A CURIE from OMOP
  sdoh_type:
    range: uriorcurie
    slot_uri: bdchm:category
    description: The type of SDOH observation
  data_type:
    range: DataTypeEnum
    description: The data type of the observation
  age_at_observation:
    range: Quantity
    description: Age of the subject at the time of observation
  age_at_condition_start:
    range: Quantity
    description: Age of the subject at the start of the condition
  age_at_condition_end:
    range: Quantity
    description: Age of the subject at the end of the condition
  age_at_exposure_start:
    range: Quantity
    description: Age of the subject at the start of drug exposure
  age_at_exposure_end:
    range: Quantity
    description: Age of the subject at the end of drug exposure
  age_at_procedure:
    range: Quantity
    description: Age of the subject at the time of the procedure

#────────────────────────────────────────────────────────────────
# ENUMS
#────────────────────────────────────────────────────────────────

enums:
  DataTypeEnum:
    description: The data type of an observation value
    permissible_values:
      decimal:
        description: Decimal number
      integer:
        description: Integer number
      enum:
        description: Enumerated value
      boolean:
        description: Boolean value
  MethodEnum:
    description: The method used for a measurement or observation
    permissible_values:
      placeholder:
        description: Placeholder value
  InstrumentEnum:
    description: The instrument used for a measurement
    permissible_values:
      placeholder:
        description: Placeholder value
  ReagentKitEnum:
    description: The reagent kit used for a measurement
    permissible_values:
      placeholder:
        description: Placeholder value
  BodyPositionEnum:
    description: The body position during a measurement
    permissible_values:
      supine:
        description: Lying face up
      standing:
        description: Standing upright
      sitting:
        description: Seated position
  ContextEnum:
    description: The context in which a measurement was taken
    permissible_values:
      fasted_8_hrs:
        description: Fasted for 8 hours
      fasted_12_hrs:
        description: Fasted for 12 hours
      before_bronchodilator:
        description: Before bronchodilator administration
      after_bronchodilator:
        description: After bronchodilator administration
      taking_lipid_lowering_medications:
        description: While taking lipid-lowering medications
      before_physical_activity:
        description: Before physical activity
      during_physical_activity:
        description: During physical activity
      after_physical_activity:
        description: After physical activity
      during_procedure:
        description: During a procedure
      taking_diabetes_medication:
        description: While taking diabetes medication
      lowest:
        description: Lowest recorded value
  CollectedByEnum:
    description: Who collected the measurement
    permissible_values:
      doctor:
        description: Collected by a doctor
      nurse:
        description: Collected by a nurse
      technician:
        description: Collected by a technician
      self_administered:
        description: Self-administered by the patient
      first_examiner:
        description: Collected by the first examiner
      second_examiner:
        description: Collected by the second examiner
  DiagnosisMethodEnum:
    description: The method used for diagnosis
    permissible_values:
      placeholder:
        description: Placeholder value
